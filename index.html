<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ghanti | Professional Bell Simulator</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;800&display=swap');
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #050505;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .bell-path {
            transition: fill 0.3s ease, stroke 0.3s ease;
        }

        /* Glassmorphism for the control panel */
        .glass-panel {
            background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(12px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Range input styling */
        input[type="range"] {
            -webkit-appearance: none;
            height: 4px;
            background: #333;
            border-radius: 2px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body class="text-white overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const GhantiApp = () => {
            // --- State Management ---
            const [status, setStatus] = useState('IDLE'); // IDLE, ACTIVE
            const [isRinging, setIsRinging] = useState(false);
            const [settings, setSettings] = useState({
                color: '#EAB308', // Default Gold
                volume: 0.6,
                timer: 0 // 0 = Manual
            });
            const [ringCount, setRingCount] = useState(0);

            const audioCtx = useRef(null);
            const timerRef = useRef(null);
            const lastShake = useRef(0);

            // --- Audio Engine (Physical Modeling) ---
            const playSound = useCallback(() => {
                if (!audioCtx.current) {
                    audioCtx.current = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                if (audioCtx.current.state === 'suspended') {
                    audioCtx.current.resume();
                }

                const now = audioCtx.current.currentTime;
                const gainNode = audioCtx.current.createGain();
                gainNode.gain.setValueAtTime(settings.volume, now);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 2.5);
                gainNode.connect(audioCtx.current.destination);

                // Complex frequencies for realistic metal resonance
                const frequencies = [350, 700, 1100, 1500]; 
                frequencies.forEach((f, i) => {
                    const osc = audioCtx.current.createOscillator();
                    osc.type = i === 0 ? 'sine' : 'triangle';
                    osc.frequency.setValueAtTime(f, now);
                    
                    const localGain = audioCtx.current.createGain();
                    localGain.gain.setValueAtTime(0.4 / (i + 1), now);
                    localGain.gain.exponentialRampToValueAtTime(0.01, now + (2 - i * 0.4));
                    
                    osc.connect(localGain);
                    localGain.connect(gainNode);
                    osc.start();
                    osc.stop(now + 2.5);
                });

                if ("vibrate" in navigator) navigator.vibrate(100);
            }, [settings.volume]);

            const triggerRing = useCallback(() => {
                const now = Date.now();
                if (now - lastShake.current < 500) return; // Prevention of double triggers
                
                lastShake.current = now;
                setIsRinging(true);
                setRingCount(prev => prev + 1);
                playSound();
                setTimeout(() => setIsRinging(false), 600);
            }, [playSound]);

            // --- Sensor Initialization ---
            const initSensors = async () => {
                try {
                    if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
                        const permission = await DeviceMotionEvent.requestPermission();
                        if (permission === 'granted') startMotionListener();
                    } else {
                        startMotionListener();
                    }
                    setStatus('ACTIVE');
                    triggerRing(); // Play initial sound to unlock AudioContext
                } catch (e) {
                    alert("Motion sensors blocked. Using touch-only mode.");
                    setStatus('ACTIVE');
                }
            };

            const startMotionListener = () => {
                let threshold = 22;
                window.addEventListener('devicemotion', (e) => {
                    const acc = e.accelerationIncludingGravity;
                    if (!acc) return;
                    const magnitude = Math.sqrt(acc.x**2 + acc.y**2 + acc.z**2);
                    if (magnitude > threshold) triggerRing();
                });
            };

            // --- Timer Logic ---
            useEffect(() => {
                if (settings.timer > 0 && status === 'ACTIVE') {
                    timerRef.current = setInterval(triggerRing, settings.timer * 1000);
                } else {
                    clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [settings.timer, status, triggerRing]);

            return (
                <div className="flex flex-col h-screen w-full justify-between pb-safe">
                    {/* Header */}
                    <div className="pt-16 text-center">
                        <h1 className="text-4xl font-extrabold tracking-tighter" style={{ color: settings.color }}>GHANTI</h1>
                        <p className="text-[10px] uppercase tracking-[0.4em] opacity-40">Professional Grade</p>
                    </div>

                    {/* Bell Section */}
                    <div className="flex-1 flex flex-col items-center justify-center">
                        <div 
                            onClick={status === 'IDLE' ? initSensors : triggerRing}
                            className={`transition-all duration-500 transform cursor-pointer
                                ${isRinging ? 'rotate-12 scale-110' : 'rotate-0 scale-100'}
                                ${status === 'IDLE' ? 'opacity-20 blur-sm' : 'opacity-100'}
                            `}
                        >
                            <svg width="220" height="220" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path 
                                    className="bell-path"
                                    d="M18 8C18 6.4087 17.3679 4.88258 16.2426 3.75736C15.1174 2.63214 13.5913 2 12 2C10.4087 2 8.88258 2.63214 7.75736 3.75736C6.63214 4.88258 6 6.4087 6 8C6 15 3 17 3 17H21C21 17 18 15 18 8Z" 
                                    stroke={settings.color} 
                                    strokeWidth="1.5" 
                                    fill={isRinging ? settings.color + '44' : 'transparent'}
                                />
                                <path d="M10.3 21C10.62 21.51 11.16 21.86 11.76 21.97C12.37 22.08 12.99 21.95 13.5 21.6" stroke={settings.color} strokeWidth="1.5" strokeLinecap="round"/>
                            </svg>
                        </div>
                        {status === 'ACTIVE' && (
                            <div className="mt-8 text-center animate-pulse">
                                <span className="text-4xl font-light opacity-20">{ringCount}</span>
                            </div>
                        )}
                    </div>

                    {/* Controls Section */}
                    <div className="glass-panel p-8 rounded-t-[40px] space-y-6">
                        {status === 'IDLE' ? (
                            <button 
                                onClick={initSensors}
                                className="w-full py-5 bg-white text-black rounded-2xl font-bold uppercase tracking-widest text-sm active:scale-95 transition-transform"
                            >
                                Activate System
                            </button>
                        ) : (
                            <div className="space-y-6">
                                {/* Color Picker */}
                                <div className="flex justify-between items-center">
                                    <span className="text-[10px] font-bold uppercase tracking-widest opacity-50">App Theme</span>
                                    <div className="flex gap-3">
                                        {['#EAB308', '#3B82F6', '#EF4444', '#10B981', '#FFFFFF'].map(c => (
                                            <button 
                                                key={c} 
                                                onClick={() => setSettings(s => ({...s, color: c}))}
                                                className={`w-6 h-6 rounded-full border-2 ${settings.color === c ? 'border-white' : 'border-transparent'}`}
                                                style={{ backgroundColor: c }}
                                            />
                                        ))}
                                    </div>
                                </div>

                                {/* Volume Slider */}
                                <div className="space-y-2">
                                    <div className="flex justify-between text-[10px] font-bold uppercase tracking-widest opacity-50">
                                        <span>Acoustic Volume</span>
                                        <span>{Math.round(settings.volume * 100)}%</span>
                                    </div>
                                    <input 
                                        type="range" min="0" max="1" step="0.01" 
                                        value={settings.volume}
                                        onChange={(e) => setSettings(s => ({...s, volume: parseFloat(e.target.value)}))}
                                        className="w-full"
                                    />
                                </div>

                                {/* Timer Slider */}
                                <div className="space-y-2">
                                    <div className="flex justify-between text-[10px] font-bold uppercase tracking-widest opacity-50">
                                        <span>Auto-Interval</span>
                                        <span>{settings.timer === 0 ? 'Manual' : settings.timer + 's'}</span>
                                    </div>
                                    <input 
                                        type="range" min="0" max="30" step="1" 
                                        value={settings.timer}
                                        onChange={(e) => setSettings(s => ({...s, timer: parseInt(e.target.value)}))}
                                        className="w-full"
                                    />
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GhantiApp />);
    </script>
</body>
</html>
