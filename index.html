<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ghanti Pro Max | Interactive Simulator</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tap-highlight-none { -webkit-tap-highlight-color: transparent; }
        input[type='range'] { -webkit-appearance: none; background: #333; height: 4px; border-radius: 2px; }
        input[type='range']::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; background: #EAB308; border-radius: 50%; }
    </style>
</head>
<body class="bg-[#0a0a0a] text-white overflow-hidden select-none tap-highlight-none">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        const { motion, AnimatePresence } = FramerMotion;

        const GhantiApp = () => {
            // State Management
            const [status, setStatus] = useState('IDLE');
            const [isRinging, setIsRinging] = useState(false);
            const [settings, setSettings] = useState({
                color: '#EAB308',
                volume: 0.5,
                timer: 0 // In seconds, 0 = manual only
            });
            const [showSettings, setShowSettings] = useState(false);
            
            const audioCtx = useRef(null);
            const timerRef = useRef(null);

            // Physical Sound Model: The "Real" Bell
            const playRealBell = useCallback(() => {
                if (!audioCtx.current) audioCtx.current = new (window.AudioContext || window.webkitAudioContext)();
                const now = audioCtx.current.currentTime;
                
                const masterGain = audioCtx.current.createGain();
                masterGain.gain.setValueAtTime(settings.volume, now);
                masterGain.gain.exponentialRampToValueAtTime(0.001, now + 3);
                masterGain.connect(audioCtx.current.destination);

                // Frequencies for a rich Bronze Temple Bell (non-harmonic overtones)
                const components = [
                    { f: 250, g: 0.5, d: 2.5 }, // Strike
                    { f: 500, g: 0.3, d: 3.0 }, // Hum
                    { f: 780, g: 0.2, d: 1.5 }, // Tierce
                    { f: 1200, g: 0.1, d: 1.0 } // Shimmer
                ];

                components.forEach(comp => {
                    const osc = audioCtx.current.createOscillator();
                    const g = audioCtx.current.createGain();
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(comp.f, now);
                    g.gain.setValueAtTime(comp.g, now);
                    g.gain.exponentialRampToValueAtTime(0.01, now + comp.d);
                    osc.connect(g);
                    g.connect(masterGain);
                    osc.start();
                    osc.stop(now + comp.d);
                });

                if ("vibrate" in navigator) navigator.vibrate(80);
            }, [settings.volume]);

            const trigger = useCallback(() => {
                setIsRinging(true);
                playRealBell();
                setTimeout(() => setIsRinging(false), 500);
            }, [playRealBell]);

            // Timer Logic
            useEffect(() => {
                if (settings.timer > 0 && status === 'ACTIVE') {
                    timerRef.current = setInterval(trigger, settings.timer * 1000);
                } else {
                    clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [settings.timer, status, trigger]);

            const setupSensors = async () => {
                if (typeof DeviceMotionEvent?.requestPermission === 'function') {
                    const res = await DeviceMotionEvent.requestPermission();
                    if (res !== 'granted') return;
                }
                
                window.addEventListener('devicemotion', (e) => {
                    const acc = e.accelerationIncludingGravity;
                    if (!acc) return;
                    const magnitude = Math.sqrt(acc.x**2 + acc.y**2 + acc.z**2);
                    if (magnitude > 22) trigger();
                });
                
                setStatus('ACTIVE');
                playRealBell(); // Init audio
            };

            return (
                <div className="flex flex-col h-screen w-full px-6 py-12">
                    <div className="text-center">
                        <h1 className="text-3xl font-black tracking-tighter" style={{color: settings.color}}>GHANTI PRO</h1>
                        <p className="text-[10px] text-gray-500 uppercase tracking-[0.3em]">Advanced Sonic Simulation</p>
                    </div>

                    <div className="flex-1 flex items-center justify-center relative">
                        <motion.div 
                            animate={isRinging ? { 
                                rotate: [0, 30, -25, 15, -10, 0],
                                scale: [1, 1.1, 1] 
                            } : { rotate: 0 }}
                            transition={{ duration: 0.5 }}
                            onClick={status === 'IDLE' ? setupSensors : trigger}
                            className="cursor-pointer"
                        >
                            <svg width="200" height="200" viewBox="0 0 24 24" fill="none" stroke={settings.color} strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
                                <path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9" fill={settings.color + '20'} />
                                <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                            </svg>
                        </motion.div>
                    </div>

                    {/* Bottom Controls */}
                    <div className="bg-[#151515] p-6 rounded-3xl border border-white/5 space-y-6">
                        <div className="flex justify-between items-center">
                            <span className="text-xs font-bold uppercase text-gray-400">Settings</span>
                            <button onClick={() => setShowSettings(!showSettings)} className="text-xs text-yellow-500">
                                {showSettings ? 'Close' : 'Adjust'}
                            </button>
                        </div>

                        {showSettings && (
                            <motion.div initial={{ height: 0, opacity: 0 }} animate={{ height: 'auto', opacity: 1 }} className="space-y-4 overflow-hidden">
                                <div>
                                    <label className="text-[10px] uppercase text-gray-500 block mb-2">Bell Color</label>
                                    <div className="flex gap-3">
                                        {['#EAB308', '#EF4444', '#3B82F6', '#10B981', '#FFFFFF'].map(c => (
                                            <div key={c} onClick={() => setSettings({...settings, color: c})} className="w-8 h-8 rounded-full border-2 border-transparent" style={{backgroundColor: c, borderColor: settings.color === c ? 'white' : 'transparent'}} />
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <label className="text-[10px] uppercase text-gray-500 block mb-1">Volume: {Math.round(settings.volume * 100)}%</label>
                                    <input type="range" className="w-full" min="0" max="1" step="0.1" value={settings.volume} onChange={(e) => setSettings({...settings, volume: parseFloat(e.target.value)})} />
                                </div>
                                <div>
                                    <label className="text-[10px] uppercase text-gray-500 block mb-1">Auto-Timer: {settings.timer}s</label>
                                    <input type="range" className="w-full" min="0" max="10" step="1" value={settings.timer} onChange={(e) => setSettings({...settings, timer: parseInt(e.target.value)})} />
                                </div>
                            </motion.div>
                        )}
                        
                        {status === 'IDLE' && (
                            <button onClick={setupSensors} className="w-full py-4 bg-white text-black font-bold rounded-xl uppercase tracking-widest text-xs">
                                Activate Ghanti
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GhantiApp />);
    </script>
</body>
</html>
